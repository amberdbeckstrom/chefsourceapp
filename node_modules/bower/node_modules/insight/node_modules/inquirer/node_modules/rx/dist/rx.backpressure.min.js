(function(t){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=e[typeof window]&&window||this,r=e[typeof exports]&&exports&&!exports.nodeType&&exports,i=e[typeof module]&&module&&!module.nodeType&&module,o=(i&&i.exports===r&&r,e[typeof global]&&global);!o||o.global!==o&&o.window!==o||(n=o),"function"==typeof define&&define.amd?define(["rx","exports"],function(e,r){return n.Rx=t(n,r,e),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=t(n,module.exports,require("./rx")):n.Rx=t(n,{},n.Rx)}).call(this,function(t,e,n,r){function i(){if(this.isDisposed)throw Error(m)}function o(t,e,n){return new c(function(i){function o(t,e){l[e]=t;var o;if(u[e]=!0,c||(c=u.every(v))){try{o=n.apply(null,l)}catch(s){return i.onError(s),r}i.onNext(o)}else h&&i.onCompleted()}var s=2,u=[!1,!1],c=!1,h=!1,l=Array(s);return new a(t.subscribe(function(t){o(t,0)},i.onError.bind(i),function(){h=!0,i.onCompleted()}),e.subscribe(function(t){o(t,1)},i.onError.bind(i)))})}var s=n.Observable,u=s.prototype,c=n.AnonymousObservable,a=n.CompositeDisposable,h=n.Subject,l=n.Observer,f=n.Disposable.empty,p=n.Disposable.create,d=n.internals.inherits,b=n.internals.addProperties,v=(n.Scheduler.timeout,n.helpers.identity),m="Object has been disposed",y=function(t){function e(t){var e=this.source.publish(),n=e.subscribe(t),r=f,i=this.subject.distinctUntilChanged().subscribe(function(t){t?r=e.connect():(r.dispose(),r=f)});return new a(n,r,i)}function n(n,r){this.source=n,this.subject=r||new h,this.isPaused=!0,t.call(this,e)}return d(n,t),n.prototype.pause=function(){this.isPaused!==!0&&(this.isPaused=!0,this.subject.onNext(!1))},n.prototype.resume=function(){this.isPaused!==!1&&(this.isPaused=!1,this.subject.onNext(!0))},n}(s);u.pausable=function(t){return new y(this,t)};var w=function(t){function e(t){var e,n=[],i=o(this.source,this.subject.distinctUntilChanged(),function(t,e){return{data:t,shouldFire:e}}).subscribe(function(i){if(e!==r&&i.shouldFire!=e){if(i.shouldFire)for(;n.length>0;)t.onNext(n.shift())}else i.shouldFire?t.onNext(i.data):n.push(i.data);e=i.shouldFire},function(e){for(;n.length>0;)t.onNext(n.shift());t.onError(e)},function(){for(;n.length>0;)t.onNext(n.shift());t.onCompleted()});return this.subject.onNext(!1),i}function n(n,r){this.source=n,this.subject=r||new h,this.isPaused=!0,t.call(this,e)}return d(n,t),n.prototype.pause=function(){this.isPaused!==!0&&(this.isPaused=!0,this.subject.onNext(!1))},n.prototype.resume=function(){this.isPaused!==!1&&(this.isPaused=!1,this.subject.onNext(!0))},n}(s);u.pausableBuffered=function(t){return new w(this,t)},u.controlled=function(t){return null==t&&(t=!0),new g(this,t)};var g=function(t){function e(t){return this.source.subscribe(t)}function n(n,r){t.call(this,e),this.subject=new E(r),this.source=n.multicast(this.subject).refCount()}return d(n,t),n.prototype.request=function(t){return null==t&&(t=-1),this.subject.request(t)},n}(s),E=n.ControlledSubject=function(t){function e(t){return this.subject.subscribe(t)}function n(n){null==n&&(n=!0),t.call(this,e),this.subject=new h,this.enableQueue=n,this.queue=n?[]:null,this.requestedCount=0,this.requestedDisposable=f,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.controlledDisposable=f}return d(n,t),b(n.prototype,l,{onCompleted:function(){i.call(this),this.hasCompleted=!0,this.enableQueue&&0!==this.queue.length||this.subject.onCompleted()},onError:function(t){i.call(this),this.hasFailed=!0,this.error=t,this.enableQueue&&0!==this.queue.length||this.subject.onError(t)},onNext:function(t){i.call(this);var e=!1;0===this.requestedCount?this.enableQueue&&this.queue.push(t):(-1!==this.requestedCount&&0===this.requestedCount--&&this.disposeCurrentRequest(),e=!0),e&&this.subject.onNext(t)},_processRequest:function(t){if(this.enableQueue){for(;this.queue.length>=t&&t>0;)this.subject.onNext(this.queue.shift()),t--;return 0!==this.queue.length?{numberOfItems:t,returnValue:!0}:{numberOfItems:t,returnValue:!1}}return this.hasFailed?(this.subject.onError(this.error),this.controlledDisposable.dispose(),this.controlledDisposable=f):this.hasCompleted&&(this.subject.onCompleted(),this.controlledDisposable.dispose(),this.controlledDisposable=f),{numberOfItems:t,returnValue:!1}},request:function(t){i.call(this),this.disposeCurrentRequest();var e=this,n=this._processRequest(t);return t=n.numberOfItems,n.returnValue?f:(this.requestedCount=t,this.requestedDisposable=p(function(){e.requestedCount=0}),this.requestedDisposable)},disposeCurrentRequest:function(){this.requestedDisposable.dispose(),this.requestedDisposable=f},dispose:function(){this.isDisposed=!0,this.error=null,this.subject.dispose(),this.requestedDisposable.dispose()}}),n}(s);return n});