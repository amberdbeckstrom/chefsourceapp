(function(t){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=e[typeof window]&&window||this,r=e[typeof exports]&&exports&&!exports.nodeType&&exports,i=e[typeof module]&&module&&!module.nodeType&&module,o=(i&&i.exports===r&&r,e[typeof global]&&global);!o||o.global!==o&&o.window!==o||(n=o),"function"==typeof define&&define.amd?define(["rx","exports"],function(e,r){return n.Rx=t(n,r,e),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=t(n,module.exports,require("./rx")):n.Rx=t(n,{},n.Rx)}).call(this,function(t,e,n,r){function i(t,e){return 1===t.length&&Array.isArray(t[e])?t[e]:O.call(t)}function o(t,e){this.scheduler=t,this.disposable=e,this.isDisposed=!1}function s(t,e,n){for(var r=0,i=t.length;i>r;r++)if(n(t[r],e))return r;return-1}function u(t){this.comparer=t,this.set=[]}var c=n.Observable,a=c.prototype,h=c.never,l=c.throwException,f=n.AnonymousObservable,p=n.Observer,d=n.Subject,b=n.internals,v=n.helpers,m=b.ScheduledObserver,y=n.SingleAssignmentDisposable,w=n.CompositeDisposable,g=n.RefCountDisposable,E=n.Disposable.empty,x=n.Scheduler.immediate,C=(v.defaultKeySerializer,n.internals.addRef),N=(v.identity,v.isPromise),D=b.inherits,S=(v.noop,v.isScheduler),A=c.fromPromise,O=Array.prototype.slice,_="Argument out of range";o.prototype.dispose=function(){var t=this;this.scheduler.schedule(function(){t.isDisposed||(t.isDisposed=!0,t.disposable.dispose())})},function(t){function e(e){t.call(this),this._observer=e,this._state=0}D(e,t);var n=e.prototype;return n.onNext=function(t){this.checkAccess();try{this._observer.onNext(t)}catch(e){throw e}finally{this._state=0}},n.onError=function(t){this.checkAccess();try{this._observer.onError(t)}catch(e){throw e}finally{this._state=2}},n.onCompleted=function(){this.checkAccess();try{this._observer.onCompleted()}catch(t){throw t}finally{this._state=2}},n.checkAccess=function(){if(1===this._state)throw Error("Re-entrancy detected");if(2===this._state)throw Error("Observer completed");0===this._state&&(this._state=1)},e}(p);var j=function(t){function e(){t.apply(this,arguments)}return D(e,t),e.prototype.next=function(e){t.prototype.next.call(this,e),this.ensureActive()},e.prototype.error=function(e){t.prototype.error.call(this,e),this.ensureActive()},e.prototype.completed=function(){t.prototype.completed.call(this),this.ensureActive()},e}(m);a.observeOn=function(t){var e=this;return new f(function(n){return e.subscribe(new j(t,n))})},a.subscribeOn=function(t){var e=this;return new f(function(n){var r=new y,i=new SerialDisposable;return i.setDisposable(r),r.setDisposable(t.schedule(function(){i.setDisposable(new o(t,e.subscribe(n)))})),i})},c.generate=function(t,e,n,i,o){return S(o)||(o=currentThreadScheduler),new f(function(s){var u=!0,c=t;return o.scheduleRecursive(function(t){var o,a;try{u?u=!1:c=n(c),o=e(c),o&&(a=i(c))}catch(h){return s.onError(h),r}o?(s.onNext(a),t()):s.onCompleted()})})},c.using=function(t,e){return new f(function(n){var r,i,o=E;try{r=t(),r&&(o=r),i=e(r)}catch(s){return new w(l(s).subscribe(n),o)}return new w(i.subscribe(n),o)})},a.amb=function(t){var e=this;return new f(function(n){function r(){o||(o=s,a.dispose())}function i(){o||(o=u,c.dispose())}var o,s="L",u="R",c=new y,a=new y;return N(t)&&(t=A(t)),c.setDisposable(e.subscribe(function(t){r(),o===s&&n.onNext(t)},function(t){r(),o===s&&n.onError(t)},function(){r(),o===s&&n.onCompleted()})),a.setDisposable(t.subscribe(function(t){i(),o===u&&n.onNext(t)},function(t){i(),o===u&&n.onError(t)},function(){i(),o===u&&n.onCompleted()})),new w(c,a)})},c.amb=function(){function t(t,e){return t.amb(e)}for(var e=h(),n=i(arguments,0),r=0,o=n.length;o>r;r++)e=t(e,n[r]);return e},a.onErrorResumeNext=function(t){if(!t)throw Error("Second observable is required");return R([this,t])};var R=c.onErrorResumeNext=function(){var t=i(arguments,0);return new f(function(e){var n=0,r=new SerialDisposable,i=x.scheduleRecursive(function(i){var o,s;t.length>n?(o=t[n++],N(o)&&(o=A(o)),s=new y,r.setDisposable(s),s.setDisposable(o.subscribe(e.onNext.bind(e),function(){i()},function(){i()}))):e.onCompleted()});return new w(r,i)})};return a.bufferWithCount=function(t,e){return"number"!=typeof e&&(e=t),this.windowWithCount(t,e).selectMany(function(t){return t.toArray()}).where(function(t){return t.length>0})},a.windowWithCount=function(t,e){var n=this;if(0>=t)throw Error(_);if(1===arguments.length&&(e=t),0>=e)throw Error(_);return new f(function(r){var i=new y,o=new g(i),s=0,u=[],c=function(){var t=new d;u.push(t),r.onNext(C(t,o))};return c(),i.setDisposable(n.subscribe(function(n){for(var r,i=0,o=u.length;o>i;i++)u[i].onNext(n);var a=s-t+1;a>=0&&0===a%e&&(r=u.shift(),r.onCompleted()),s++,0===s%e&&c()},function(t){for(;u.length>0;)u.shift().onError(t);r.onError(t)},function(){for(;u.length>0;)u.shift().onCompleted();r.onCompleted()})),o})},a.takeLastBuffer=function(t){var e=this;return new f(function(n){var r=[];return e.subscribe(function(e){r.push(e),r.length>t&&r.shift()},n.onError.bind(n),function(){n.onNext(r),n.onCompleted()})})},a.defaultIfEmpty=function(t){var e=this;return t===r&&(t=null),new f(function(n){var r=!1;return e.subscribe(function(t){r=!0,n.onNext(t)},n.onError.bind(n),function(){r||n.onNext(t),n.onCompleted()})})},u.prototype.push=function(t){var e=-1===s(this.set,t,this.comparer);return e&&this.set.push(t),e},a.distinct=function(t,e){var n=this;return e||(e=defaultComparer),new f(function(i){var o=new u(e);return n.subscribe(function(e){var n=e;if(t)try{n=t(e)}catch(s){return i.onError(s),r}o.push(n)&&i.onNext(e)},i.onError.bind(i),i.onCompleted.bind(i))})},n});